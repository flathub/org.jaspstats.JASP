{
	"app-id":			"org.jaspstats.JASP",
	"runtime": 			"org.kde.Platform",
	"runtime-version":	"6.2",
	"sdk": 				"org.kde.Sdk",
	"base":				"io.qt.qtwebengine.BaseApp",
	"base-version":		"6.2",
	"command": 			"org.jaspstats.JASP",
	"finish-args": [
		"--socket=x11",
		"--socket=wayland",
		"--share=ipc",
		"--share=network",
		"--filesystem=home",
		"--device=dri"
	],
	"build-options": {
		"cxxflags": 				"-O2 -g -Wno-error",
		"cflags": 					"-Wno-error",
		"ldflags":					"-lgfortran",
		"append-ld-library-path": 	"/app/lib64/R/lib",
		"env": {

            "CXX11":		"g++",
			"CXX14":		"g++",
			"CXX11FLAGS":	"-std=gnu++11",
			"CXX14FLAGS":	"-std=gnu++14",

			"JASP_R_REPOSITORY":				"file:///app/lib64/local-cran",
			"GITHUB_PAT_DEF":					"Z2hwX0M3YnZhaEJIYjF5QVVxN0p5NmtjTXhpcWRveXIyOTEwOXc4Rwo",
			"GITHUB_PAT":						"Z2hwX1FVQmt2dWk0WFV5SWJrN0VKc2JUWWVnTzFaVnQxbzROWmxwdwo",

			"GIT_DISCOVERY_ACROSS_FILESYSTEM":	"true",

			"PREFIX": 							"/app",
			"R_HOME": 							"/app/lib64/R/",

			"QMAKEPATH":						"/app/lib"
		}
	},
	"cleanup": [
		"/include"
	],
	"modules":[
		{
			"name":			"qt5compat",
			"buildsystem":	"cmake",
			"sources":[
				{
					"type":	"git",
					"tag":	"v6.2.3",
					"url":	"https://github.com/qt/qt5compat"					
				}
			]	
		},
		{
			"name": 		"boost",
			"buildsystem": 	"simple",
			"build-commands":[
				"./bootstrap.sh --with-libraries=filesystem,system,date_time,chrono,timer",
				"./b2 -j${FLATPAK_BUILDER_N_JOBS} install --prefix=/app" 
			],
			"sources":[
				{
					"type": 	"git",
					"url": 		"https://github.com/boostorg/boost",
					"sha256": 	"boost-1.78.0"
				}
			]
		},
		{
			"name": "r",
			"config-opts": ["--enable-R-shlib", "--disable-BLAS-shlib"],
			"build-options": {
				"env": {
					"CXX11":		"g++",
					"CXX14":		"g++",
					"CXX11FLAGS":	"-std=gnu++11",
					"CXX14FLAGS":	"-std=gnu++14"
				}
			},
			"sources": [
				{
					"type":   "archive",
					"url":    "http://cran.r-project.org/src/base/R-4/R-4.1.3.tar.gz",
					"sha256": "15ff5b333c61094060b2a52e9c1d8ec55cc42dd029e39ca22abdaa909526fed6"
				}
			]
		},
		{
			"name": 		"LAPACK",
			"buildsystem":	"cmake",
			"builddir":		true,
			"sources": [
				{
					"type":	"git",
					"tag":	"v3.10.0",
					"url": 	"https://github.com/Reference-LAPACK/lapack"
				} ]
		},
		{
			"name": 		"jsoncpp",
			"buildsystem":	"cmake",
			"builddir":		true,
			"sources": [
				{
					"type":	"git",
					"tag":	"1.9.5",
					"url": 	"https://github.com/open-source-parsers/jsoncpp"
				} ]
		},
		{
			"name":		"JAGS",
			"sources": [
				{
					"type":   "archive",
					"sha256": "8ac5dd57982bfd7d5f0ee384499d62f3e0bb35b5f1660feb368545f1186371fc",
					"url":    "https://static.jasp-stats.org/RPkgs/JAGS-4.3.0.tar.gz"
				} ]
		},
		{
			"name":			"git2",
			"buildsystem":	"cmake",
			"builddir":		true,
			"sources": [
				{
					"type":   	"git",
					"tag": 		"v1.2.0",
					"url":    	"https://github.com/libgit2/libgit2"
				} ]
		},



		{
			"name": "readstat",
			"sources": [
				{
					"type":	"git",
					"tag":	"v1.1.7",
					"url": 	"https://github.com/WizardMac/ReadStat"
				} ]
		},
		{
			"name": 		"jasp",
			"buildsystem": 	"cmake-ninja",
			"builddir":		true,
			"config-opts": 
			[ 
				"--trace-expand",
				"-DINSTALL_R_MODULES=ON",
				"-DFLATPAK_USED=ON",
				"-DQt6WebEngineQuick_DIR=/app/lib/${FLATPAK_ARCH}-linux-gnu/cmake/Qt6WebEngineQuick/",
				"-DQt6Core5Compat_DIR=/app/lib/${FLATPAK_ARCH}-linux-gnu/cmake/Qt6Core5Compat/"
			] ,
			"sources":
			[
				{
					"type":		"git",
					"commit":	"96707a8267df63a8865e57ee7776e2af74372813",
					"url": 		"https://github.com/amirmasoudabdol/jasp-desktop"
				}
			]
		}
	]
}
